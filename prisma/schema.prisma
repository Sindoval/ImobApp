generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Usuario {
  id                String   @id @default(cuid())
  nome              String
  email             String   @unique
  senhaHash         String
  ativo             Boolean  @default(true)
  roleId            String
  role              Role     @relation(fields: [roleId], references: [id], onDelete: Cascade)
  engenheiroImoveis Imovel[] @relation("ImovelEngenheiro")
  pedidosCriados    Pedido[] @relation("PedidosCriados")
  pedidosAprovados  Pedido[] @relation("PedidosAprovados")
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}

model Role {
  id        String    @id @default(cuid())
  nome      String    @unique
  usuarios  Usuario[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

model PasswordResetToken {
  id        String   @id @default(cuid())
  email     String
  token     String
  expiresAt DateTime
  createdAt DateTime @default(now())
}

model Imovel {
  id           String         @id @default(cuid())
  endereco     String
  descricao    String?
  valorCompra  Float
  valorVenda   Float?
  status       String
  prazoFinal   DateTime?
  engenheiroId String
  engenheiro   Usuario        @relation("ImovelEngenheiro", fields: [engenheiroId], references: [id], onDelete: Cascade)
  imagens      ImovelImagem[]
  pedidos      Pedido[]
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
}

model ImovelImagem {
  id        String   @id @default(cuid())
  imovelId  String
  url       String
  publicId  String
  descricao String?
  createdAt DateTime @default(now())
  imovel    Imovel   @relation(fields: [imovelId], references: [id])
}

model Pedido {
  id               String  @id @default(cuid())
  descricao        String
  status           String
  notaFiscalUrl    String?
  diretoParaImovel Boolean @default(false)
  imovelId         String?
  imovel           Imovel? @relation(fields: [imovelId], references: [id], onDelete: Cascade)

  fornecedorId String?
  fornecedor   Fornecedor? @relation(fields: [fornecedorId], references: [id], onDelete: SetNull)

  criadoPorId String
  criadoPor   Usuario @relation("PedidosCriados", fields: [criadoPorId], references: [id], onDelete: Cascade)

  aprovadoPorId String?
  aprovadoPor   Usuario? @relation("PedidosAprovados", fields: [aprovadoPorId], references: [id], onDelete: SetNull)

  itens     PedidoItem[]
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
}

model PedidoItem {
  id         String @id @default(cuid())
  nome       String
  quantidade Int
  precoUnit  Float

  pedidoId String
  pedido   Pedido @relation(fields: [pedidoId], references: [id])
}

model Produto {
  id        String   @id @default(cuid())
  nome      String
  descricao String?
  unidade   String
  estoque   Estoque?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Estoque {
  id         String   @id @default(cuid())
  produtoId  String   @unique
  produto    Produto  @relation(fields: [produtoId], references: [id], onDelete: Cascade)
  quantidade Int
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model Fornecedor {
  id        String   @id @default(cuid())
  nome      String
  contato   String?
  pedidos   Pedido[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
